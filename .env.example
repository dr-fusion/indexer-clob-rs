# =============================================================================
# CLOB Indexer Configuration
# =============================================================================

# -----------------------------------------------------------------------------
# Required - Chain & RPC Configuration
# -----------------------------------------------------------------------------
CHAIN_ID=6343
RPC_URL=https://carrot.megaeth.com/rpc
WS_URL=wss://carrot.megaeth.com/ws

# -----------------------------------------------------------------------------
# Adaptive Batch Sizing (AIMD Algorithm)
# Dynamically adjusts batch size based on RPC responses
# -----------------------------------------------------------------------------
BATCH_SIZE_INITIAL=10000      # Starting batch size
BATCH_SIZE_MIN=10             # Minimum (floor) - won't go below this
BATCH_SIZE_MAX=10000          # Maximum (ceiling)
BATCH_SIZE_DECREASE_FACTOR=0.5  # Multiply on error (0.5 = halve)
BATCH_SIZE_INCREASE_FACTOR=0.1  # Increase by 10% after success threshold
BATCH_SIZE_SUCCESS_THRESHOLD=10 # Consecutive successes before increase

# -----------------------------------------------------------------------------
# Adaptive Concurrency (AIMD Algorithm)
# Dynamically adjusts concurrent RPC requests based on responses
# -----------------------------------------------------------------------------
CONCURRENCY_INITIAL=10        # Starting concurrency level
CONCURRENCY_MIN=1             # Minimum (floor)
CONCURRENCY_MAX=20            # Maximum (ceiling)
CONCURRENCY_DECREASE_FACTOR=0.5  # Multiply on error (0.5 = halve)
CONCURRENCY_INCREASE_FACTOR=0.1  # Increase by 10% after success threshold
CONCURRENCY_SUCCESS_THRESHOLD=20 # Consecutive successes before increase

# -----------------------------------------------------------------------------
# Database - PostgreSQL (Optional)
# If not set, runs in memory-only mode without persistence
# -----------------------------------------------------------------------------
DATABASE_URL=postgres://postgres:password@localhost:5432/postgres
DATABASE_MAX_CONNECTIONS=10
DATABASE_MIN_CONNECTIONS=2
DATABASE_CONNECT_TIMEOUT=30
DATABASE_IDLE_TIMEOUT=600

# -----------------------------------------------------------------------------
# Database BatchWriter Configuration
# Controls how data is batched before writing to database
# -----------------------------------------------------------------------------
DB_BATCH_SIZE=1000            # Items before flush trigger
DB_FLUSH_INTERVAL_MS=1000     # Flush interval in milliseconds
DB_CHANNEL_CAPACITY=50000     # mpsc channel capacity

# -----------------------------------------------------------------------------
# Redis - Streaming (Optional)
# If not set, runs without real-time event streaming
# -----------------------------------------------------------------------------
REDIS_URL=redis://127.0.0.1:6379
REDIS_STREAM_KEY=events:stream
REDIS_MAX_LEN=100000
REDIS_ASYNC=true
REDIS_QUEUE_CAPACITY=100000   # Async queue size (messages to buffer)
REDIS_BATCH_SIZE=100          # Messages per pipeline batch

# Debouncing for pool stats and ticker updates
STATS_DEBOUNCE_MS=100
STATS_MAX_DEBOUNCE_MS=500

# -----------------------------------------------------------------------------
# Candle Aggregator Configuration
# Controls candlestick generation from trades
# -----------------------------------------------------------------------------
CANDLE_FLUSH_INTERVAL_SECS=60  # Flush candles to DB interval
CANDLE_RETENTION_SECS=86400    # Keep in memory (24h default)

# -----------------------------------------------------------------------------
# GraphQL API Server (Starts automatically if DATABASE_URL is set)
# -----------------------------------------------------------------------------
API_HOST=0.0.0.0
API_PORT=4000
API_CORS_ENABLED=true
API_CORS_ORIGINS=http://localhost:3000,https://app.example.com

# -----------------------------------------------------------------------------
# Prometheus Metrics (Optional)
# Set METRICS_PORT or METRICS_ENABLED to enable
# -----------------------------------------------------------------------------
METRICS_HOST=0.0.0.0
METRICS_PORT=9090
METRICS_ENABLED=true

# -----------------------------------------------------------------------------
# Logging
# -----------------------------------------------------------------------------
RUST_LOG=info,indexer_sync=info,indexer_processor=info
